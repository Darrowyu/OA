# OA 系统开发任务清单

## 待办事项

- [x] 统一部门选择组件 - 使用 shadcn/ui Select 替代原生 select
- [x] 完善错误处理 - 添加统一的错误提示机制
- [x] 部门搜索优化 - 支持过滤而非仅高亮
- [x] 添加部门拖拽排序功能

## 进行中

- [ ] 当前无进行中任务

## 已完成

- [x] 项目初始化与规范建立 - 2026-02-26
- [x] 组织管理页面添加部门管理Tab - 2026-02-26
- [x] 部门增删改查功能 - 2026-02-26
- [x] 部门树形展示与搜索 - 2026-02-26
- [x] 修复React Tabs受控组件问题 - 2026-02-26
- [x] 统一模态框设计风格 - 2026-02-26
- [x] 统一部门选择组件为 shadcn/ui Select - 2026-02-26
- [x] 创建 useErrorHandler 统一错误处理 Hook - 2026-02-26
- [x] 部门搜索支持过滤 + 高亮显示 - 2026-02-26
- [x] 部门拖拽排序功能 - 2026-02-26

## 复盘总结

### 关键决策
- 将部门管理拆分为6个独立组件，符合200行组件限制
- 使用自定义 hook (useDepartmentTree) 管理部门树状态，避免闭包问题
- 采用受控 Tabs 组件模式，确保页面切换正常工作

### 经验教训
- **Tabs 组件陷阱**: shadcn/ui 的 Tabs 是受控组件，必须使用 `value` + `onValueChange`，不能用 `defaultValue`
- **组件拆分**: 585行的组件拆分为6个后，可维护性显著提升
- **闭包问题**: 使用函数式更新 `setState(prev => ...)` 避免闭包陷阱
- **保持 tasks/todo.md 实时更新**: 开发前写待办，完成后标记

### 技术债
- DepartmentFormDialog 中使用原生 select，应统一为 shadcn/ui Select
- 部分 API 错误静默处理，需统一错误提示机制
